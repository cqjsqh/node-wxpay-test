!function(e,n){function t(n,t,o){if(t||(t=e.location.search),!n||!t)return"";var i="",a=new RegExp("(^|&|\\?)"+n+"=([^&#]*)(&|$|#)","i"),c=t.match(a);return c&&(i=o?c[2]:decodeURIComponent(c[2])),i}function o(){x.removeClass("weui-actionsheet_toggle"),k.fadeOut(200)}function i(e){b.hide(),k.hide(),j.show(),T.html(e)}function a(){console.log("ready"),n("#pay-java").click(function(){s("java")}),n("#pay-node").click(function(){s("node")})}function c(e){return new Promise(function(t,o){if(sessionStorage.openid)t(sessionStorage.openid);else{var i="node"===e?"/api/getopenid":_.openid;n.get(i+"?code="+sessionStorage.code).then(function(e){var n=e.data;n&&n.openid?(sessionStorage.openid=n.openid,t(n.openid)):o()})}})}function d(e){i("get_brand_wcpay_request:ok"===e.err_msg?"微信支付成功!":"get_brand_wcpay_request:cancel"===e.err_msg?"用户取消支付!":"支付失败!")}function s(e){x.removeClass("weui-actionsheet_toggle"),k.hide(),b.fadeIn(100),c(e).then(function(t){if("node"===e)n.get("/api/unifiedorder?openid="+t).then(function(e){var n=e.data;b.fadeOut(100),WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:n.appId,timeStamp:n.timeStamp,nonceStr:n.nonceStr,package:n.package,signType:n.signType,paySign:n.paySign},d)}).catch(function(){i("请求错误")});else{var o="test"+(new Date).getTime(),a={openId:t,orderNo:o,payAmount:1,useTime:2,chairCode:f};n.ajax({url:_.wxpay,headers:{Accept:"application/json","Content-Type":"application/json"},timeout:3e4,type:"POST",data:JSON.stringify(a),success:function(e){var n=+e.code,t=e.data;b.fadeOut(100),0===n||200===n?WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:g,timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:"prepay_id="+t.prepayId,signType:"MD5",paySign:t.paySign},d):i("数据错误，错误码："+n)},error:function(){i("请求错误")}})}})}var p=t("code")||sessionStorage.code,r=sessionStorage.openid,u=encodeURIComponent("http://z.hdk4.com/d.html"),g="wxbce0a3daf503097c",l="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+g+"&redirect_uri="+u+"&response_type=code&scope=snsapi_base&state=7",m="http://z.hdk4.com/d.html",f=t("d")||"mytest1",h="http",y="39.108.72.98",S=9999,w=h+"://"+y+(80===S?"":":"+S),_={openid:w+"/wx/v1/account/getWxOpenId",wxpay:w+"/pay/v1/weChatPay-info"};r||(p?sessionStorage.code||(sessionStorage.code=p,e.location.replace(m)):e.location.replace(l));var v=n("#app"),k=n("#smc-mask"),x=n("#smc-action-sheet"),C=n("#btn-select"),I=n("#btn-cancel"),b=n("#smc-loading"),j=n("#smc-dialog"),T=n("#smc-result");k.click(o),I.click(o),C.click(function(){x.addClass("weui-actionsheet_toggle"),k.fadeIn(200)}),v.on("click",".weui-dialog__btn",function(){n(this).parents(".js_dialog").hide()}),"undefined"==typeof WeixinJSBridge&&document.addEventListener("WeixinJSBridgeReady",a,!1)}(window,jQuery);